How to get CCLS working (Ubuntu 18.04):

- Build CCLS using system LLVM, but version 7:

sudo apt install llvm-7 clang-7 libclang-7-dev

cmake -H. -BRelease -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_PREFIX_PATH=/usr/lib/llvm-7 \
    -DLLVM_INCLUDE_DIR=/usr/lib/llvm-7/include \
    -DLLVM_BUILD_INCLUDE_DIR=/usr/include/llvm-7/

- Create ccls_wrapper.sh with the following contents:

#!/usr/bin/env bash

/home/eddie/localbuild/ccls/ccls/Release/ccls --init='{"clang":{"extraArgs": ["--gcc-toolchain=/media/Extra/spack/opt/spack/linux-ubuntu18.04-skylake/gcc-7.5.0/gcc-10.2.0-hp2j5ulzmsa5i4jegogfwqmccsbg44mq/"]}}' "$@"

- Set the ccls executable to the wrapper in init.el:

(use-package ccls
  :init
  (setq ccls-executable "/home/eddie/ccls_wrapper.sh")
  :hook ((c-mode c++-mode) .
         (lambda () (require 'ccls) (lsp))))

- Symlink compile_commands.json into the project root
